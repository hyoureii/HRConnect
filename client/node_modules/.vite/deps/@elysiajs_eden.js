import "./chunk-G3PMV62Z.js";

// ../node_modules/.bun/@elysiajs+eden@1.4.6+e5c2a00a368eaaae/node_modules/@elysiajs/eden/dist/chunk-QSLHAOSM.mjs
var s = class extends Error {
  constructor(e, n) {
    super(n + "");
    this.status = e;
    this.value = n;
  }
};
var i = /(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/;
var o = /(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/;
var c = /^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/;
var u = (t) => t.trim().length !== 0 && !Number.isNaN(Number(t));
var d = (t) => {
  if (typeof t != "string") return null;
  let r = t.replace(/"/g, "");
  if (i.test(r) || o.test(r) || c.test(r)) {
    let e = new Date(r);
    if (!Number.isNaN(e.getTime())) return e;
  }
  return null;
};
var a = (t) => {
  let r = t.charCodeAt(0), e = t.charCodeAt(t.length - 1);
  return r === 123 && e === 125 || r === 91 && e === 93;
};
var p = (t) => JSON.parse(t, (r, e) => {
  let n = d(e);
  return n || e;
});
var g = (t) => {
  if (!t) return t;
  if (u(t)) return +t;
  if (t === "true") return true;
  if (t === "false") return false;
  let r = d(t);
  if (r) return r;
  if (a(t)) try {
    return p(t);
  } catch {
  }
  return t;
};
var S = (t) => {
  let r = t.data.toString();
  return r === "null" ? null : g(r);
};

// ../node_modules/.bun/@elysiajs+eden@1.4.6+e5c2a00a368eaaae/node_modules/@elysiajs/eden/dist/chunk-EF6Z4LSD.mjs
var K = (n, e, t) => {
  if (n.endsWith("/") || (n += "/"), e === "index" && (e = ""), !t || !Object.keys(t).length) return `${n}${e}`;
  let s2 = "";
  for (let [c2, a2] of Object.entries(t)) s2 += `${c2}=${a2}&`;
  return `${n}${e}?${s2.slice(0, -1)}`;
};
var $ = typeof FileList > "u";
var M = (n) => $ ? n instanceof Blob : n instanceof FileList || n instanceof File;
var H = (n) => {
  if (!n) return false;
  for (let e in n) {
    if (M(n[e])) return true;
    if (Array.isArray(n[e]) && n[e].find((t) => M(t))) return true;
  }
  return false;
};
var x = (n) => $ ? n : new Promise((e) => {
  let t = new FileReader();
  t.onload = () => {
    let s2 = new File([t.result], n.name, { lastModified: n.lastModified, type: n.type });
    e(s2);
  }, t.readAsArrayBuffer(n);
});
var T = class {
  ws;
  url;
  constructor(e) {
    this.ws = new WebSocket(e), this.url = e;
  }
  send(e) {
    return Array.isArray(e) ? (e.forEach((t) => this.send(t)), this) : (this.ws.send(typeof e == "object" ? JSON.stringify(e) : e.toString()), this);
  }
  on(e, t, s2) {
    return this.addEventListener(e, t, s2);
  }
  off(e, t, s2) {
    return this.ws.removeEventListener(e, t, s2), this;
  }
  subscribe(e, t) {
    return this.addEventListener("message", e, t);
  }
  addEventListener(e, t, s2) {
    return this.ws.addEventListener(e, (c2) => {
      if (e === "message") {
        let a2 = S(c2);
        t({ ...c2, data: a2 });
      } else t(c2);
    }, s2), this;
  }
  removeEventListener(e, t, s2) {
    return this.off(e, t, s2), this;
  }
  close() {
    return this.ws.close(), this;
  }
};
var j = (n, e = "", t) => new Proxy(() => {
}, { get(s2, c2, a2) {
  return j(n, `${e}/${c2.toString()}`, t);
}, apply(s2, c2, [a2, b = {}] = [{}, {}]) {
  let f = a2 !== void 0 && (typeof a2 != "object" || Array.isArray(a2)) ? a2 : void 0, { $query: I, $fetch: F, $headers: P2, $transform: m, getRaw: C2, ...q } = a2 ?? {};
  f ??= q;
  let w2 = e.lastIndexOf("/"), E = e.slice(w2 + 1).toUpperCase(), v = K(n, w2 === -1 ? "/" : e.slice(0, w2), Object.assign(b.query ?? {}, I)), D = t.fetcher ?? fetch, l = t.transform ? Array.isArray(t.transform) ? t.transform : [t.transform] : void 0, S3 = m ? Array.isArray(m) ? m : [m] : void 0;
  return S3 && (l ? l = S3.concat(l) : l = S3), E === "SUBSCRIBE" ? new T(v.replace(/^([^]+):\/\//, v.startsWith("https://") ? "wss://" : "ws://")) : (async (N2) => {
    let r, R = { ...t.$fetch?.headers, ...F?.headers, ...b.headers, ...P2 };
    if (E !== "GET" && E !== "HEAD") {
      r = Object.keys(f).length || Array.isArray(f) ? f : void 0;
      let p2 = r && (typeof r == "object" || Array.isArray(f));
      if (p2 && H(r)) {
        let u2 = new FormData();
        for (let [h, o2] of Object.entries(r)) if ($) u2.append(h, o2);
        else if (o2 instanceof File) u2.append(h, await x(o2));
        else if (o2 instanceof FileList) for (let d2 = 0; d2 < o2.length; d2++) u2.append(h, await x(o2[d2]));
        else if (Array.isArray(o2)) for (let d2 = 0; d2 < o2.length; d2++) {
          let k2 = o2[d2];
          u2.append(h, k2 instanceof File ? await x(k2) : k2);
        }
        else u2.append(h, o2);
        r = u2;
      } else r != null && (R["content-type"] = p2 ? "application/json" : "text/plain", r = p2 ? JSON.stringify(r) : f);
    }
    let i2 = await D(v, { method: E, body: r, ...t.$fetch, ...b.fetch, ...F, headers: R }), g2;
    if (N2.getRaw) return i2;
    switch (i2.headers.get("Content-Type")?.split(";")[0]) {
      case "application/json":
        g2 = await i2.json();
        break;
      default:
        g2 = await i2.text().then(g);
    }
    let B2 = i2.status >= 300 || i2.status < 200 ? new s(i2.status, g2) : null, A = { data: g2, error: B2, response: i2, status: i2.status, headers: i2.headers };
    if (l) for (let p2 of l) {
      let y = p2(A);
      y instanceof Promise && (y = await y), y != null && (A = y);
    }
    return A;
  })({ getRaw: C2 });
} });
var z = (n, e = { fetcher: fetch }) => new Proxy({}, { get(t, s2) {
  return j(n, s2, e);
} });

// ../node_modules/.bun/@elysiajs+eden@1.4.6+e5c2a00a368eaaae/node_modules/@elysiajs/eden/dist/chunk-7WR4DS5F.mjs
var C = class {
  constructor(t) {
    this.url = t;
    this.ws = new WebSocket(t);
  }
  ws;
  send(t) {
    return Array.isArray(t) ? (t.forEach((n) => this.send(n)), this) : (this.ws.send(typeof t == "object" ? JSON.stringify(t) : t.toString()), this);
  }
  on(t, n, r) {
    return this.addEventListener(t, n, r);
  }
  off(t, n, r) {
    return this.ws.removeEventListener(t, n, r), this;
  }
  subscribe(t, n) {
    return this.addEventListener("message", t, n);
  }
  addEventListener(t, n, r) {
    return this.ws.addEventListener(t, (a2) => {
      if (t === "message") {
        let l = S(a2);
        n({ ...a2, data: l });
      } else n(a2);
    }, r), this;
  }
  removeEventListener(t, n, r) {
    return this.off(t, n, r), this;
  }
  close() {
    return this.ws.close(), this;
  }
};
var $2 = ["get", "post", "put", "delete", "patch", "options", "head", "connect", "subscribe"];
var P = ["localhost", "127.0.0.1", "0.0.0.0"];
var N = typeof FileList > "u";
var K2 = (e) => N ? e instanceof Blob : e instanceof FileList || e instanceof File;
var G = (e) => {
  if (!e) return false;
  for (let t in e) if (K2(e[t]) || Array.isArray(e[t]) && e[t].find(K2)) return true;
  return false;
};
var M2 = (e) => N ? e : new Promise((t) => {
  let n = new FileReader();
  n.onload = () => {
    let r = new File([n.result], e.name, { lastModified: e.lastModified, type: e.type });
    t(r);
  }, n.readAsArrayBuffer(e);
});
var k = async (e, t, n = {}, r = {}) => {
  if (Array.isArray(e)) {
    for (let a2 of e) if (!Array.isArray(a2)) r = await k(a2, t, n, r);
    else {
      let l = a2[0];
      if (typeof l == "string") r[l.toLowerCase()] = a2[1];
      else for (let [i2, p2] of l) r[i2.toLowerCase()] = p2;
    }
    return r;
  }
  if (!e) return r;
  switch (typeof e) {
    case "function":
      if (e instanceof Headers) return k(e, t, n, r);
      let a2 = await e(t, n);
      return a2 ? k(a2, t, n, r) : r;
    case "object":
      if (e instanceof Headers) return e.forEach((l, i2) => {
        r[i2.toLowerCase()] = l;
      }), r;
      for (let [l, i2] of Object.entries(e)) r[l.toLowerCase()] = i2;
      return r;
    default:
      return r;
  }
};
function B(e) {
  let t = e.split(`
`), n = {};
  for (let r of t) {
    if (!r || r.startsWith(":")) continue;
    let a2 = r.indexOf(":");
    if (a2 > 0) {
      let l = r.slice(0, a2).trim(), i2 = r.slice(a2 + 1).replace(/^ /, "");
      n[l] = i2 && g(i2);
    }
  }
  return Object.keys(n).length > 0 ? n : null;
}
function* J(e) {
  let t;
  for (; (t = e.value.indexOf(`

`)) !== -1; ) {
    let n = e.value.slice(0, t);
    if (e.value = e.value.slice(t + 2), n.trim()) {
      let r = B(n);
      r && (yield r);
    }
  }
}
async function* z2(e) {
  let t = e.body;
  if (!t) return;
  let n = t.getReader(), r = new TextDecoder("utf-8"), a2 = { value: "" };
  try {
    for (; ; ) {
      let { done: i2, value: p2 } = await n.read();
      if (i2) break;
      let j3 = typeof p2 == "string" ? p2 : r.decode(p2, { stream: true });
      a2.value += j3, yield* J(a2);
    }
    let l = r.decode();
    if (l && (a2.value += l), yield* J(a2), a2.value.trim()) {
      let i2 = B(a2.value);
      i2 && (yield i2);
    }
  } finally {
    n.releaseLock();
  }
}
var L = (e, t, n = [], r) => new Proxy(() => {
}, { get(a2, l) {
  return L(e, t, l === "index" ? n : [...n, l], r);
}, apply(a2, l, [i2, p2]) {
  if (!i2 || p2 || typeof i2 == "object" && Object.keys(i2).length !== 1 || $2.includes(n.at(-1))) {
    let j3 = [...n], A = j3.pop(), b = "/" + j3.join("/"), { fetcher: H2 = fetch, headers: F, onRequest: w2, onResponse: O, fetch: U } = t, E = A === "get" || A === "head" || A === "subscribe", q = E ? i2?.query : p2?.query, W = "";
    if (q) {
      let s2 = (v, d2) => {
        W += (W ? "&" : "?") + `${encodeURIComponent(v)}=${encodeURIComponent(d2)}`;
      };
      for (let [v, d2] of Object.entries(q)) {
        if (Array.isArray(d2)) {
          for (let f of d2) s2(v, f);
          continue;
        }
        if (d2 != null) {
          if (typeof d2 == "object") {
            s2(v, JSON.stringify(d2));
            continue;
          }
          s2(v, `${d2}`);
        }
      }
    }
    if (A === "subscribe") {
      let s2 = e.replace(/^([^]+):\/\//, e.startsWith("https://") ? "wss://" : e.startsWith("http://") || P.find((v) => e.includes(v)) ? "ws://" : "wss://") + b + W;
      return new C(s2);
    }
    return (async () => {
      F = await k(F, b, p2);
      let s2 = { method: A?.toUpperCase(), body: i2, ...U, headers: F };
      s2.headers = { ...F, ...await k(E ? i2?.headers : p2?.headers, b, s2) };
      let v = E && typeof i2 == "object" ? i2.fetch : p2?.fetch;
      if (s2 = { ...s2, ...v }, E && delete s2.body, w2) {
        Array.isArray(w2) || (w2 = [w2]);
        for (let u2 of w2) {
          let c2 = await u2(b, s2);
          typeof c2 == "object" && (s2 = { ...s2, ...c2, headers: { ...s2.headers, ...await k(c2.headers, b, s2) } });
        }
      }
      if (E && delete s2.body, G(i2)) {
        let u2 = new FormData(), c2 = (o2) => {
          if (typeof o2 == "string" || K2(o2)) return false;
          if (typeof o2 == "object") {
            if (o2 !== null) return true;
            if (o2 instanceof Date) return false;
          }
          return false;
        }, g2 = async (o2) => o2 instanceof File ? await M2(o2) : c2(o2) ? JSON.stringify(o2) : o2;
        for (let [o2, y] of Object.entries(s2.body)) {
          if (Array.isArray(y)) {
            if (y.some((m) => typeof m == "object" && m !== null && !K2(m))) u2.append(o2, JSON.stringify(y));
            else for (let m = 0; m < y.length; m++) {
              let _ = y[m], V = await g2(_);
              u2.append(o2, V);
            }
            continue;
          }
          if (N) {
            if (Array.isArray(y)) for (let S3 of y) u2.append(o2, await g2(S3));
            else u2.append(o2, await g2(y));
            continue;
          }
          if (y instanceof File) {
            u2.append(o2, await M2(y));
            continue;
          }
          if (y instanceof FileList) {
            for (let S3 = 0; S3 < y.length; S3++) u2.append(o2, await M2(y[S3]));
            continue;
          }
          u2.append(o2, await g2(y));
        }
        s2.body = u2;
      } else typeof i2 == "object" ? (s2.headers["content-type"] = "application/json", s2.body = JSON.stringify(i2)) : i2 != null && (s2.headers["content-type"] = "text/plain");
      if (E && delete s2.body, w2) {
        Array.isArray(w2) || (w2 = [w2]);
        for (let u2 of w2) {
          let c2 = await u2(b, s2);
          typeof c2 == "object" && (s2 = { ...s2, ...c2, headers: { ...s2.headers, ...await k(c2.headers, b, s2) } });
        }
      }
      p2?.headers?.["content-type"] && (s2.headers["content-type"] = p2?.headers["content-type"]);
      let d2 = e + b + W, f;
      try {
        f = await (r?.handle(new Request(d2, s2)) ?? H2(d2, s2));
      } catch (u2) {
        return { data: null, error: new s(503, u2), response: void 0, status: 503, headers: void 0 };
      }
      let h = null, x2 = null;
      if (O) {
        Array.isArray(O) || (O = [O]);
        for (let u2 of O) try {
          let c2 = await u2(f.clone());
          if (c2 != null) {
            h = c2;
            break;
          }
        } catch (c2) {
          c2 instanceof s ? x2 = c2 : x2 = new s(422, c2);
          break;
        }
      }
      if (h !== null) return { data: h, error: x2, response: f, status: f.status, headers: f.headers };
      switch (f.headers.get("Content-Type")?.split(";")[0]) {
        case "text/event-stream":
          h = z2(f);
          break;
        case "application/json":
          h = JSON.parse(await f.text(), (c2, g2) => {
            if (typeof g2 != "string") return g2;
            let o2 = d(g2);
            return o2 || g2;
          });
          break;
        case "application/octet-stream":
          h = await f.arrayBuffer();
          break;
        case "multipart/form-data":
          let u2 = await f.formData();
          h = {}, u2.forEach((c2, g2) => {
            h[g2] = c2;
          });
          break;
        default:
          h = await f.text().then(g);
      }
      return (f.status >= 300 || f.status < 200) && (x2 = new s(f.status, h), h = null), { data: h, error: x2, response: f, status: f.status, headers: f.headers };
    })();
  }
  return typeof i2 == "object" ? L(e, t, [...n, Object.values(i2)[0]], r) : L(e, t, n);
} });
var te = (e, t = {}) => typeof e == "string" ? (t.keepDomain || (e.includes("://") || (e = (P.find((n) => e.includes(n)) ? "http://" : "https://") + e), e.endsWith("/") && (e = e.slice(0, -1))), L(e, t)) : (typeof window < "u" && console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."), L("http://e.ly", t, [], e));

// ../node_modules/.bun/@elysiajs+eden@1.4.6+e5c2a00a368eaaae/node_modules/@elysiajs/eden/dist/chunk-VMSCNLL4.mjs
var j2 = async (t) => {
  switch (t.headers.get("Content-Type")?.split(";")[0]) {
    case "application/json":
      return t.json();
    case "application/octet-stream":
      return t.arrayBuffer();
    case "multipart/form-data": {
      let e = await t.formData(), s2 = {};
      return e.forEach((c2, a2) => {
        s2[a2] = c2;
      }), s2;
    }
  }
  return t.text().then(g);
};
var w = async (t, r) => {
  let e = await j2(t);
  return t.status > 300 ? { data: null, status: t.status, headers: t.headers, retry: r, error: new s(t.status, e) } : { data: e, error: null, status: t.status, headers: t.headers, retry: r };
};
var S2 = (t, r) => (e, { query: s2, params: c2, body: a2, ...i2 } = {}) => {
  c2 && Object.entries(c2).forEach(([n, o2]) => {
    e = e.replace(`:${n}`, o2);
  });
  let d2 = r?.fetcher || globalThis.fetch, y = s2 ? Object.fromEntries(Object.entries(s2).filter(([n, o2]) => o2 != null)) : null, m = y ? `?${new URLSearchParams(y).toString()}` : "", E = `${t}${e}${m}`, h = new Headers(i2.headers || {}), f = h.get("content-type");
  if (!(a2 instanceof FormData) && !(a2 instanceof URLSearchParams) && (!f || f === "application/json")) try {
    a2 = JSON.stringify(a2), f || h.set("content-type", "application/json");
  } catch {
  }
  let g2 = { ...i2, method: i2.method?.toUpperCase() || "GET", headers: h, body: a2 }, u2 = () => d2(E, g2).then((n) => w(n, u2)).catch((n) => ({ data: null, error: new s(503, n), status: 503, headers: void 0, retry: u2 }));
  return u2();
};
export {
  s as EdenFetchError,
  S2 as edenFetch,
  z as edenTreaty,
  te as treaty
};
//# sourceMappingURL=@elysiajs_eden.js.map
