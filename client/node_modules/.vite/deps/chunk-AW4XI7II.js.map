{
  "version": 3,
  "sources": ["../../../../node_modules/.bun/better-auth@1.4.10+2d8ddc2d470fbe56/node_modules/better-auth/src/plugins/access/access.ts"],
  "sourcesContent": ["import { BetterAuthError } from \"@better-auth/core/error\";\nimport type { Statements, Subset } from \"./types\";\n\nexport type AuthorizeResponse =\n\t| { success: false; error: string }\n\t| { success: true; error?: never | undefined };\n\nexport function role<TStatements extends Statements>(statements: TStatements) {\n\treturn {\n\t\tauthorize<K extends keyof TStatements>(\n\t\t\trequest: {\n\t\t\t\t[key in K]?:\n\t\t\t\t\t| TStatements[key]\n\t\t\t\t\t| {\n\t\t\t\t\t\t\tactions: TStatements[key];\n\t\t\t\t\t\t\tconnector: \"OR\" | \"AND\";\n\t\t\t\t\t  };\n\t\t\t},\n\t\t\tconnector: \"OR\" | \"AND\" = \"AND\",\n\t\t): AuthorizeResponse {\n\t\t\tlet success = false;\n\t\t\tfor (const [requestedResource, requestedActions] of Object.entries(\n\t\t\t\trequest,\n\t\t\t)) {\n\t\t\t\tconst allowedActions = statements[requestedResource];\n\t\t\t\tif (!allowedActions) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: `You are not allowed to access resource: ${requestedResource}`,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(requestedActions)) {\n\t\t\t\t\tsuccess = (requestedActions as string[]).every((requestedAction) =>\n\t\t\t\t\t\tallowedActions.includes(requestedAction),\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tif (typeof requestedActions === \"object\") {\n\t\t\t\t\t\tconst actions = requestedActions as {\n\t\t\t\t\t\t\tactions: string[];\n\t\t\t\t\t\t\tconnector: \"OR\" | \"AND\";\n\t\t\t\t\t\t};\n\t\t\t\t\t\tif (actions.connector === \"OR\") {\n\t\t\t\t\t\t\tsuccess = actions.actions.some((requestedAction) =>\n\t\t\t\t\t\t\t\tallowedActions.includes(requestedAction),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tsuccess = actions.actions.every((requestedAction) =>\n\t\t\t\t\t\t\t\tallowedActions.includes(requestedAction),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new BetterAuthError(\"Invalid access control request\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (success && connector === \"OR\") {\n\t\t\t\t\treturn { success };\n\t\t\t\t}\n\t\t\t\tif (!success && connector === \"AND\") {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\terror: `unauthorized to access resource \"${requestedResource}\"`,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (success) {\n\t\t\t\treturn {\n\t\t\t\t\tsuccess,\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: \"Not authorized\",\n\t\t\t};\n\t\t},\n\t\tstatements,\n\t};\n}\n\nexport function createAccessControl<const TStatements extends Statements>(\n\ts: TStatements,\n) {\n\treturn {\n\t\tnewRole<K extends keyof TStatements>(statements: Subset<K, TStatements>) {\n\t\t\treturn role<Subset<K, TStatements>>(statements);\n\t\t},\n\t\tstatements: s,\n\t};\n}\n"],
  "mappings": ";;;;;AAOA,SAAgB,KAAqC,YAAyB;AAC7E,SAAO;IACN,UACC,SAQA,YAA0B,OACN;AACpB,UAAI,UAAU;AACd,iBAAW,CAAC,mBAAmB,gBAAA,KAAqB,OAAO,QAC1D,OAAA,GACE;AACF,cAAM,iBAAiB,WAAW,iBAAA;AAClC,YAAI,CAAC,eACJ,QAAO;UACN,SAAS;UACT,OAAO,2CAA2C,iBAAA;;AAGpD,YAAI,MAAM,QAAQ,gBAAA,EACjB,WAAW,iBAA8B,MAAA,CAAO,oBAC/C,eAAe,SAAS,eAAA,CAAgB;iBAGrC,OAAO,qBAAqB,UAAU;AACzC,gBAAM,UAAU;AAIhB,cAAI,QAAQ,cAAc,KACzB,WAAU,QAAQ,QAAQ,KAAA,CAAM,oBAC/B,eAAe,SAAS,eAAA,CAAgB;cAGzC,WAAU,QAAQ,QAAQ,MAAA,CAAO,oBAChC,eAAe,SAAS,eAAA,CAAgB;cAI1C,OAAM,IAAI,gBAAgB,gCAAA;AAG5B,YAAI,WAAW,cAAc,KAC5B,QAAO,EAAE,QAAA;AAEV,YAAI,CAAC,WAAW,cAAc,MAC7B,QAAO;UACN,SAAS;UACT,OAAO,oCAAoC,iBAAA;;;AAI9C,UAAI,QACH,QAAO,EACN,QAAA;AAGF,aAAO;QACN,SAAS;QACT,OAAO;;;IAGT;;;AAIF,SAAgB,oBACf,GACC;AACD,SAAO;IACN,QAAqC,YAAoC;AACxE,aAAO,KAA6B,UAAA;;IAErC,YAAY;;;",
  "names": []
}
